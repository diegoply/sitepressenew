{% extends 'base.html.twig' %}

{% block title %}Liste{% endblock %}

{% block body %}



<div class="max-w-6xl mx-auto p-6">
    <h1 class="text-3xl font-bold mb-6 text-center text-green-500">Liste des Articles</h1>

    <table class="min-w-full border border-gray-200 shadow-md">
        <thead class="bg-green-100">
            <tr>
                <th class="py-3 px-6 text-left text-gray-700 uppercase font-semibold border-b text-green-500">Titre</th>
                <th class="py-3 px-6 text-left text-gray-700 uppercase font-semibold border-b text-green-500">Status</th>
                <th class="py-3 px-6 text-center text-gray-700 uppercase font-semibold border-b text-green-500">Action</th>
            </tr>
        </thead>

<tbody class="bg-white">
{% set found = false %}

{% for article in articles %}

    {% set canSee = false %}

    {# Tous les articles PUBLISHED ou ARCHIVED sont visibles #}
    {% if article.status == 'PUBLISHED' or article.status == 'ARCHIVED' %}
        {% set canSee = true %}
    {% endif %}

    {# Les articles DRAFT ne sont visibles que par l'auteur ou admin #}
    {% if article.status == 'DRAFT' and app.user and (is_granted('ROLE_ADMIN') or article.user == app.user) %}
        {% set canSee = true %}
    {% endif %}

    {% if canSee %}
        {% set found = true %}
        <tr class="hover:bg-green-50">
            <td class="py-3 px-6 border-b">{{ article.title }}</td>
            <td class="py-3 px-6 border-b">{{ article.statusLabel ?: 'Non défini' }}</td>
            <td class="py-3 px-6 border-b text-center space-x-4">
                <a href="{{ path('app_show', {'id': article.id}) }}" class="text-green-500 hover:underline">Voir</a>

                {% if app.user and (is_granted('ROLE_ADMIN') or article.user == app.user) %}
                    <a href="{{ path('app_edit', {'id': article.id}) }}" class="text-blue-500 hover:underline">Éditer</a>
                    <a href="{{ path('app_delete', {'id': article.id}) }}" class="text-red-500 hover:underline">Supprimer</a>
                {% endif %}
            </td>
        </tr>
    {% endif %}

{% endfor %}

{% if not found %}
    <tr>
        <td colspan="3" class="py-4 px-6 text-center text-gray-500">Aucun article trouvé</td>
    </tr>
{% endif %}
</tbody>


    </table>
</div>


{% endblock %}
